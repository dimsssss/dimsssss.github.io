---
title:  "ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ì˜¤í”ˆ"
date: 2024-02-26T13:20:42+09:00
categories: 
    - ì‚¬ì´ë“œ í”„ë¡œì íŠ¸
tags:
    - CD
    - AWS
    - code deploy
    - í…ŒìŠ¤íŠ¸ ì½”ë“œ
---

ì´ í”„ë¡œì íŠ¸ëŠ” ì•„ì´ëŒ íŒ¬ë“¤ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹°ì´ë‹¤. ì¢‹ì•„í•˜ëŠ” ì•„ì´ëŒì˜ í–‰ì‚¬ì™€ í›„ê¸°ë¥¼ ê³µìœ í•œë‹¤

## ì¸í”„ë¼
![](https://i.imgur.com/WyorBKo.png)


## CI/CD
husky, eslint, prettier, pre-commit í›…ì„ ì¡°í•©í•˜ì—¬ commit ì§ì „ì— ìë™ìœ¼ë¡œ eslintì™€ prettierë¥¼ ì ìš©í•´ì„œ ì¼ê´€ëœ ì½”ë“œ í’ˆì§ˆì„ ì ìš©í–ˆë‹¤.

commit í•  ë•Œë§ˆë‹¤ buildì™€ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê²Œ í–ˆë”ë‹ˆ í•œë²ˆ commit í•˜ëŠ” ì‹œê°„ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë ¸ë‹¤. pre-pushë¥¼ ì´ìš©í•˜ì—¬ linterì™€ build, testë¥¼ ë‚˜ëˆ´ê³  ê°œë°œ í•˜ë©´ì„œ ë¶ˆí¸í•œ ê²½í—˜ì„ ì—†ì•´ë‹¤ 

github actionê³¼ code deployë¥¼ ì´ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ë°°í¬ë¥¼ í•  ìˆ˜ ìˆê²Œ êµ¬ì¶•í–ˆë‹¤.

## í”„ë¡œì íŠ¸ êµ¬ì¡°
ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜ë¥¼ ë¶€ë¶„ì ìœ¼ë¡œ ì´ìš©í•˜ì˜€ë‹¤. ì•„ë˜ì˜ 3ê°œì˜ ê³„ì¸µë§Œ ë‹¨ë°©í–¥ìœ¼ë¡œ í•˜ìœ„ ê³„ì¸µë§Œ ì°¸ì¡°í•˜ë„ë¡ í•˜ì˜€ë‹¤ 

ğŸ“¦<br>
 â”£ ğŸ“œmodule.ts<br>
 â”£ ğŸ“œcontroller.ts<br>
 â”£ ğŸ“œservice.ts<br>
 â”— ğŸ“œrepository.ts

## Swagger
í”„ë¡ íŠ¸ì—”ë“œì™€ í˜‘ì—…ì„ ì›í• í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œ API ëª…ì„¸ ë¬¸ì„œê°€ í•„ìš”í–ˆë‹¤. ë°±ì—”ë“œê°€ ë§Œë“œëŠ” APIì˜ Specì„ ê¸°ë¡í• ìˆ˜ ìˆê³  í˜ì´ì§€ì—ì„œ ì§ì ‘ í˜¸ì¶œí•´ë³¼ ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ë‹¤
![](https://i.imgur.com/cDhALja.png)

## ì „ëµ íŒ¨í„´ ì ìš©
ì¸ì¦ì€ Oauth2.0 ë°©ì‹ì´ì–´ì„œ ì†Œì…œì— í† í°ì„ ë°›ì•„ì˜¤ëŠ” ë¡œì§ì€ ë¹„ìŠ·í•˜ì§€ë§Œ ìš”ì²­ ê°’ê³¼ ë°˜í™˜ ê°’ë“¤ì´ ì„œë¡œ ë‹¬ë¼ì„œ ì´ íŒ¨í„´ì„ ì‚¬ìš©í–ˆë‹¤

![](https://i.imgur.com/jjnELXA.png)



## í…ŒìŠ¤íŠ¸ ì½”ë“œ
stubì„ ì´ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±
```ts

import { plainToInstance } from 'class-transformer';
import { MailerService } from '@nestjs-modules/mailer';
import { UserRepositoryImple } from 'src/user/user.repository.impl';
import { Test } from '@nestjs/testing';
import { NotExistException } from 'src/email/exception/not.exist.exception';
import { EmailRepository } from '../../../src/email/email.repository';
import { EmailService } from '../../../src/email/email.service';
import { VerificationEmailDto } from '../../../src/email/dto/vefirication.dto';
import { EmailVerification } from 'src/email/entity/email.verifications.entity';
import { InvalidException } from 'src/user/exception/invalid.exception';

describe('email.service verificateEmail í…ŒìŠ¤íŠ¸', () => {

  let emailService: EmailService;
  let emailRepository: EmailRepository;
  let mailerService: MailerService;
  let userRepository: UserRepositoryImple;
  let moduleRef;

  const mockRepository = () => ({
    find: null,
    update: null,
  });

  

  const mockService = () => ({
    sendMail: jest.fn(),
  });

  beforeAll(async () => {
    moduleRef = await Test.createTestingModule({
      providers: [
        { provide: 'UserRepository', useValue: mockRepository() },
	    { provide: 'MailerService', useValue: mockService() },
	    { provide: 'EmailRepository', useValue: mockRepository() },
      ],
    }).compile();
  });

  test('ì´ë©”ì¼ ì¸ì¦ ì¡°ê±´ì´ ë§ì„ ë•Œ ì—…ë°ì´íŠ¸ëœ ë¡œìš° ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤', async () => {
    emailRepository = moduleRef.get('EmailRepository');
    mailerService = moduleRef.get('MailerService');
    userRepository = moduleRef.get('UserRepository');
  
    const verificationEmailDto = plainToInstance(VerificationEmailDto, {
      email: 'test@test.com',
      verificationNumber: '123456',
    });

    const current = new Date()
    current.setHours(current.getHours() + 9)
    const verificationRecord = plainToInstance(EmailVerification, { createdAt:current, key: '123456' })

    emailRepository.find = jest.fn().mockResolvedValue(verificationRecord)
    emailRepository.update = jest.fn().mockResolvedValue(1)
    emailService = new EmailService(
      userRepository,
      mailerService,
      emailRepository,
    );

    await expect(emailService.verificateEmail(verificationEmailDto)).resolves.toBe(1)});
  });
});
```


## ê²°ê³¼
![](https://i.imgur.com/XVVaHV9.png)

ì˜¤í”ˆí•œ ë‹¹ì‹œì— ê²°ê³¼ë¥¼ GA(êµ¬ê¸€ ì•„ë„ë¦¬í‹±ìŠ¤)ë¥¼ í™œìš©í•´ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. í•œ ê°œì˜ í”Œë«í¼ì— í™ë³´ë¥¼ í•œ ë²ˆ í–ˆë‹¤ê³  ë“¤ì—ˆëŠ”ë° ì´ ì •ë„ ì§€í‘œë©´ ë‚˜ë¦„ ì¢‹ë‹¤ê³  ìƒê°í•œë‹¤(ì„œë¹„ìŠ¤ íŠ¹ì„±ìƒ)
